
--[[
--æ— éšœç¢ç‰ˆä¸“ç”¨è„šæœ¬
--è„šæœ¬åç§°: åˆ‡æ¢ä¸»é¢˜
--ç”¨é€”ï¼šå¦‚ä¸Š
--ç‰ˆæœ¬å·: 2.0
â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚
æ—¥æœŸ: 2020å¹´08æœˆ25æ—¥ğŸ—“ï¸
å†œå†: é¼ ğŸåºšå­å¹´ä¸ƒæœˆåˆä¸ƒ
æ—¶é—´: 17:59:17ğŸ• 
æ˜ŸæœŸ: å‘¨äºŒ
--åˆ¶ä½œè€…: é£ä¹‹æ¼«èˆ
--é¦–å‘qqç¾¤: Rime åŒæ–‡æ–‹(458845988)
--é‚®ç®±: bj19490007@163.com(ä¸ä¸€å®šåŠæ—¶çœ‹åˆ°)

--é…ç½®è¯´æ˜
ç”¨æ³•ä¸€
ç¬¬â‘ æ­¥ å°† è„šæœ¬æ–‡ä»¶æ”¾ç½® Android/rime/script æ–‡ä»¶å¤¹å†…,

ç¬¬â‘¡æ­¥ å‘ä¸»é¢˜æ–¹æ¡ˆä¸­åŠ å…¥æŒ‰é”®
ä»¥ XXX.trime.yamlä¸»é¢˜æ–¹æ¡ˆä¸ºä¾‹
æ‰¾åˆ°ä»¥ä¸‹èŠ‚ç‚¹preset_keysï¼ŒLuaTheme0ï¼ŒLuaTheme2

preset_keys:
  LuaTheme0: {label: ä¸»é¢˜, send: function, command: 'åˆ‡æ¢ä¸»é¢˜.lua', option: ""}#æ˜¾ç¤ºrimeç›®å½•ä¸‹æ‰€æœ‰ä¸»é¢˜åˆ°ä¸€ä¸ªé”®ç›˜,ç‚¹å‡»åˆ‡æ¢å¹¶æ˜¾ç¤º
  LuaTheme1: {label: ä¸»é¢˜1, send: function, command: 'åˆ‡æ¢ä¸»é¢˜.lua', option: "ã€Šã€Šå‘½ä»¤è¡Œã€‹ã€‹ã€ã€ä¸»é¢˜å.trimeã€‘ã€‘"}#ä¸»é¢˜åç§°ä¸ºè‡ªå®šä¹‰é¡¹,æ— åç¼€åyaml,é»˜è®¤ä¸»é¢˜å‘½åä¸ºtrimeå³å¯
  
å‘è¯¥ä¸»é¢˜æ–¹æ¡ˆä»»æ„é”®ç›˜æŒ‰é”®ä¸­åŠ å…¥ä¸Šè¿°æŒ‰é”®æ—¢å¯
--------------------
ç”¨æ³•äºŒ
â‘ æ”¾åˆ°è„šæœ¬å¯åŠ¨å™¨->è„šæœ¬åº“ç›®å½• ä¸‹ä»»æ„ä½ç½®åŠå­æ–‡ä»¶å¤¹è¶³ä¸­,è„šæœ¬å¯åŠ¨å™¨è‡ªåŠ¨æ˜¾ç¤ºè¯¥è„šæœ¬
â‘¡ä¸»é¢˜æ–¹æ¡ˆæŒ‚è½½è„šæœ¬å¯åŠ¨å™¨
â‘¢æ˜¾ç¤ºä¸€ä¸ªé”®ç›˜ç•Œé¢,ç‚¹å‡»æŒ‰é”®å³å¯

åŠŸèƒ½è·³è½¬

]]




require "import"
import "java.io.*"
import "android.content.*"

import "com.osfans.trime.*" --è½½å…¥åŒ…

local å‚æ•°=(...)
local è¾“å…¥æ³•ç›®å½•=tostring(service.getLuaExtDir(""))

local è„šæœ¬ç›®å½•=tostring(service.getLuaExtDir("script"))
local è„šæœ¬è·¯å¾„=debug.getinfo(1,"S").source:sub(2)--è·å–Luaè„šæœ¬çš„å®Œæ•´è·¯å¾„

local çº¯è„šæœ¬å=File(è„šæœ¬è·¯å¾„).getName()
local ç›®å½•=string.sub(è„šæœ¬è·¯å¾„,1,#è„šæœ¬è·¯å¾„-#çº¯è„šæœ¬å)

local è„šæœ¬ç›¸å¯¹è·¯å¾„=string.sub(è„šæœ¬è·¯å¾„,#è„šæœ¬ç›®å½•+1)


local ä¸»é¢˜ç»„1=Config.getThemeKeys(true)

local ä¸»é¢˜ç»„={}

--è¯»å–æ•°ç»„å…ƒç´ 
for i=1,#ä¸»é¢˜ç»„1 do
 ä¸»é¢˜ç»„[i]=tostring(ä¸»é¢˜ç»„1[i-1])
end
table.sort(ä¸»é¢˜ç»„)--æ•°ç»„æ’åº

local æ–‡ä»¶ç»„={}
local ä¸»é¢˜åç§°ç»„={}
--è¯»å–æ•°ç»„å…ƒç´ 
for i=1,#ä¸»é¢˜ç»„ do
 æ–‡ä»¶ç»„[i]=ä¸»é¢˜ç»„[i]:sub(1,-6)
 ä¸»é¢˜åç§°ç»„[i]=ä¸»é¢˜ç»„[i]:sub(1,-12)
 if ä¸»é¢˜ç»„[i]=="tongwenfeng.trime.yaml" then ä¸»é¢˜åç§°ç»„[i]="åŒæ–‡é£" end
 if ä¸»é¢˜ç»„[i]=="trime.yaml" then ä¸»é¢˜åç§°ç»„[i]="é»˜è®¤" end
end




if å‚æ•°!=nil && string.find(å‚æ•°,"ã€ã€")!=nil && string.find(å‚æ•°,"ã€‘ã€‘")!=nil then
 local æ•°æ®æ–‡ä»¶=string.sub(å‚æ•° ,string.find(å‚æ•°,"ã€ã€")+6,string.find(å‚æ•°,"ã€‘ã€‘")-1)
 local è·¯å¾„=è¾“å…¥æ³•ç›®å½•.."/"..æ•°æ®æ–‡ä»¶..".yaml"
 if File(è·¯å¾„).exists()==false then
   print(è·¯å¾„.." ä¸»é¢˜æ–‡ä»¶ä¸å­˜åœ¨")
   return
 end
 
 local ä¸»é¢˜=Config.get()
 ä¸»é¢˜.setTheme(tostring(æ•°æ®æ–‡ä»¶)) 
 local æŒ‰é”®ç•Œé¢=Trime.getService()
 æŒ‰é”®ç•Œé¢.initKeyboard()
 print("ä¸»é¢˜å·²åˆ·æ–°")
 return
end

--å‘½ä»¤è¡Œæ¨¡å¼,ä¸æ˜¾ç¤ºé€‰æ‹©ç•Œé¢
--local å‘½ä»¤è¡Œæ¨¡å¼=false
if string.find(å‚æ•°,"ã€Šã€Šå‘½ä»¤è¡Œã€‹ã€‹")!=nil then
  return --é€€å‡º
end



local ç¼–å·=1
local çŸ­è¯­æ•°=10--å•ä¸ªé”®ç›˜çš„çŸ­è¯­æ•°é‡
local é»˜è®¤å®½åº¦=50

local æ€»åºå·=math.ceil(#æ–‡ä»¶ç»„/çŸ­è¯­æ•°)

if string.find(å‚æ•°,"<<")!=nil && string.find(å‚æ•°,">>")!=nil then
 ç¼–å·=tonumber(string.sub(å‚æ•°,string.find(å‚æ•°,"<<")+2,string.find(å‚æ•°,">>")-1))
 --print(ç¼–å·)
end



local æŒ‰é”®ç»„={}

local æŒ‰é”®1={}
 æŒ‰é”®1["width"]=100
 æŒ‰é”®1["height"]=25
 æŒ‰é”®1["click"]=""
 æŒ‰é”®1["label"]=string.sub(çº¯è„šæœ¬å,1,#çº¯è„šæœ¬å-4).."("..tostring(ç¼–å·).."/"..æ€»åºå·..")"
 æŒ‰é”®ç»„[#æŒ‰é”®ç»„+1]=æŒ‰é”®1



if ç¼–å·==1 then
 if #æ–‡ä»¶ç»„<çŸ­è¯­æ•° then
  --æŒ‰é”®ç»„=æ–‡ä»¶ç»„
  for i=1,#æ–‡ä»¶ç»„ do
   local æŒ‰é”®={}
   local ä½ç½®=i
   æŒ‰é”®["click"]={label=ä¸»é¢˜åç§°ç»„[ä½ç½®], send="function",command= è„šæœ¬ç›¸å¯¹è·¯å¾„,option= "ã€ã€"..æ–‡ä»¶ç»„[ä½ç½®].."ã€‘ã€‘"}
   æŒ‰é”®ç»„[#æŒ‰é”®ç»„+1]=æŒ‰é”®
   
  end--for
  local æŒ‰é”®={}
  æŒ‰é”®["width"]=é»˜è®¤å®½åº¦
  for i=1,çŸ­è¯­æ•°-1-#æ–‡ä»¶ç»„ do
   æŒ‰é”®ç»„[#æŒ‰é”®ç»„+1]=æŒ‰é”®
  end--for
  æŒ‰é”®ç»„[#æŒ‰é”®ç»„+1]=ä¸»é”®ç›˜()
 else
  for i=1,çŸ­è¯­æ•° do
   local å­ç¼–å·=i
   if #æ–‡ä»¶ç»„>å­ç¼–å·-1 then
    local æŒ‰é”®={}
    local ä½ç½®=i
    æŒ‰é”®["click"]={label=ä¸»é¢˜åç§°ç»„[ä½ç½®], send="function",command= è„šæœ¬ç›¸å¯¹è·¯å¾„,option=  "ã€ã€"..æ–‡ä»¶ç»„[ä½ç½®].."ã€‘ã€‘"}
    æŒ‰é”®ç»„[#æŒ‰é”®ç»„+1]=æŒ‰é”®
   end--if
  end--for

 local æŒ‰é”®2={}
 æŒ‰é”®2["click"]={label="ä¸‹ä¸€é¡µ", send="function",command= è„šæœ¬ç›¸å¯¹è·¯å¾„,option= "<<"..(ç¼–å·+1)..">>"}
 æŒ‰é”®ç»„[#æŒ‰é”®ç»„+1]=æŒ‰é”®2
 æŒ‰é”®ç»„[#æŒ‰é”®ç»„+1]=ä¸»é”®ç›˜()

 end--if #æ–‡ä»¶ç»„<25
end--if ç¼–å·==1

if ç¼–å·>1 then
if #æ–‡ä»¶ç»„<ç¼–å·*çŸ­è¯­æ•° then
  for i=1,#æ–‡ä»¶ç»„-(ç¼–å·-1)*çŸ­è¯­æ•° do
  local æŒ‰é”®={}
  local ä½ç½®=i+(ç¼–å·-1)*çŸ­è¯­æ•°
   æŒ‰é”®["click"]={label=ä¸»é¢˜åç§°ç»„[ä½ç½®], send="function",command= è„šæœ¬ç›¸å¯¹è·¯å¾„,option=  "ã€ã€"..æ–‡ä»¶ç»„[ä½ç½®].."ã€‘ã€‘"}
   æŒ‰é”®ç»„[#æŒ‰é”®ç»„+1]=æŒ‰é”®
  end--for
  local æŒ‰é”®={}
  æŒ‰é”®["width"]=é»˜è®¤å®½åº¦
  for i=1,çŸ­è¯­æ•°*ç¼–å·-#æ–‡ä»¶ç»„ do
   æŒ‰é”®ç»„[#æŒ‰é”®ç»„+1]=æŒ‰é”®
  end--for
  local æŒ‰é”®1={}
  æŒ‰é”®1["click"]={label="ä¸Šä¸€é¡µ", send="function",command= è„šæœ¬ç›¸å¯¹è·¯å¾„,option= "<<"..(ç¼–å·-1)..">>"}
 æŒ‰é”®ç»„[#æŒ‰é”®ç»„+1]=æŒ‰é”®1
 
 æŒ‰é”®ç»„[#æŒ‰é”®ç»„+1]=ä¸»é”®ç›˜()
else
  for i=1,çŸ­è¯­æ•° do
   local æŒ‰é”®={}
   local ä½ç½®=i+(ç¼–å·-1)*çŸ­è¯­æ•°
   æŒ‰é”®["click"]={label=ä¸»é¢˜åç§°ç»„[ä½ç½®], send="function",command= è„šæœ¬ç›¸å¯¹è·¯å¾„,option=  "ã€ã€"..æ–‡ä»¶ç»„[ä½ç½®].."ã€‘ã€‘"}
   æŒ‰é”®ç»„[#æŒ‰é”®ç»„+1]=æŒ‰é”®
  end--for
  local æŒ‰é”®1={}
  æŒ‰é”®1["width"]=33
 æŒ‰é”®1["click"]={label="ä¸Šä¸€é¡µ", send="function",command= è„šæœ¬ç›¸å¯¹è·¯å¾„,option= "<<"..(ç¼–å·-1)..">>"}
 æŒ‰é”®ç»„[#æŒ‰é”®ç»„+1]=æŒ‰é”®1
 local æŒ‰é”®2={}
 æŒ‰é”®2["width"]=33
 æŒ‰é”®2["click"]={label="ä¸‹ä¸€é¡µ", send="function",command= è„šæœ¬ç›¸å¯¹è·¯å¾„,option= "<<"..(ç¼–å·+1)..">>"}
 æŒ‰é”®ç»„[#æŒ‰é”®ç»„+1]=æŒ‰é”®2
 
 
 æŒ‰é”®ç»„[#æŒ‰é”®ç»„+1]=ä¸»é”®ç›˜(32,33)

end--if #æ–‡ä»¶ç»„>ç¼–å·*22
end--if ç¼–å·>1 



service.setKeyboard{
  name=string.sub(çº¯è„šæœ¬å,1,#çº¯è„šæœ¬å-4),
  ascii_mode=0,
  width=é»˜è®¤å®½åº¦,
  height=32,
  keys=æŒ‰é”®ç»„
  }



