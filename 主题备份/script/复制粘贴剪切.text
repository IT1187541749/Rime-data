--[[
--æ— éšœç¢ç‰ˆä¸“ç”¨è„šæœ¬
--ç”¨é€”ï¼šåœ¨åº”ç”¨æ²¡æœ‰å‰ªåˆ‡æ¿æƒé™çš„æƒ…å†µä¸‹ï¼Œä¾é è¾“å…¥æ³•æ¥å®ç°å‰ªåˆ‡ã€å¤åˆ¶ã€ç²˜è´´çš„åŠŸèƒ½

--ç‰ˆæœ¬å·: 1.0
--åˆ¶ä½œæ—¥æœŸ
â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚
æ—¥æœŸ: 2021å¹´04æœˆ22æ—¥ğŸ—“ï¸
å²æ¬¡: è¾›ä¸‘(ç‰›ğŸ‚)å¹´ å£¬è¾°æœˆ åºšå­æ—¥
å†œå†: äºŒé›¶äºŒä¸€å¹´ ä¸‰æœˆ(å¤§) åä¸€
æ—¶é—´: 14:51:34ğŸ•
æ˜ŸæœŸ: å‘¨å››
--åˆ¶ä½œè€…: åˆæ¬¢
--é¦–å‘qqç¾¤: ä»™é¹¤Â·å…»æ®–åœº(966868329)
--http://hehuan.ys168.com
--å¦‚ä½•å®‰è£…å¹¶ä½¿ç”¨: è¯·å‚è€ƒç¾¤æ–‡ä»¶ï¼Œè·¯å¾„[åŒæ–‡æ— éšœç¢LUAè„šæœ¬]->åŒæ–‡æ— éšœç¢ç‰ˆluaè„šæœ¬ä½¿ç”¨è¯´æ˜.pdf

--é…ç½®è¯´æ˜
ç¬¬â‘ æ­¥ å°† .lua æ–‡ä»¶æ”¾ç½® rime/script æ–‡ä»¶å¤¹å†…
ç¬¬â‘¡æ­¥ å‘ä¸»é¢˜æ–¹æ¡ˆä¸­åŠ å…¥æŒ‰é”®
ä»¥ XXX.trime.yamlä¸»é¢˜æ–¹æ¡ˆä¸ºä¾‹
æ‰¾åˆ°ä»¥ä¸‹èŠ‚ç‚¹preset_keys,åŠ å…¥ä»¥ä¸‹å†…å®¹

preset_keys:
  Lua_cut: {label: å‰ªåˆ‡, send: function, command: 'å¤åˆ¶ç²˜è´´å‰ªåˆ‡.lua', option: "ã€Šã€Šå‘½ä»¤è¡Œã€‹ã€‹ã€ã€å‰ªåˆ‡ã€‘ã€‘"} #åœ¨è¯¥åº”ç”¨æ— å‰ªåˆ‡æ¿æƒé™çš„æƒ…å†µä¸‹å‰ªåˆ‡
  Lua_copy: {label: å¤åˆ¶, send: function, command: 'å¤åˆ¶ç²˜è´´å‰ªåˆ‡.lua', option: "ã€Šã€Šå‘½ä»¤è¡Œã€‹ã€‹ã€ã€å¤åˆ¶ã€‘ã€‘"} #åœ¨è¯¥åº”ç”¨æ— å‰ªåˆ‡æ¿æƒé™çš„æƒ…å†µä¸‹å¤åˆ¶
  Lua_paste: {label: ç²˜è´´, send: function, command: 'å¤åˆ¶ç²˜è´´å‰ªåˆ‡.lua', option: "ã€Šã€Šå‘½ä»¤è¡Œã€‹ã€‹ã€ã€ç²˜è´´ã€‘ã€‘"} #åœ¨è¯¥åº”ç”¨æ— å‰ªåˆ‡æ¿æƒé™çš„æƒ…å†µä¸‹ç²˜è´´

å‘è¯¥ä¸»é¢˜æ–¹æ¡ˆä»»æ„é”®ç›˜æŒ‰é”®ä¸­åŠ å…¥ä¸Šè¿°æŒ‰é”®æ—¢å¯
--]]



require "import"
import "android.content.Context" --å¯¼å…¥ç±»
import "com.osfans.trime.*" --è½½å…¥åŒ…


local å‚æ•°=(...)

if å‚æ•°!=nil && string.find(å‚æ•°,"ã€Šã€Šå‘½ä»¤è¡Œã€‹ã€‹")!=nil && string.find(å‚æ•°,"ã€ã€ç²˜è´´ã€‘ã€‘")!=nil then
	local å‰ªè´´æ¿å†…å®¹=""
	if service.getClipBoard().toString() ~="[]" then
		å‰ªè´´æ¿å†…å®¹=service.getClipBoard()[0]  --è¯»å–å‰ªåˆ‡æ¿æ•°ç»„"ä»0å¼€å§‹"
	else
		å‰ªè´´æ¿å†…å®¹=service.getSystemService(Context.CLIPBOARD_SERVICE).getText()
	end
	service.commitText(å‰ªè´´æ¿å†…å®¹)
end



local é€‰ä¸­å†…å®¹=service.getCurrentInputConnection()
if é€‰ä¸­å†…å®¹!=nil then
  é€‰ä¸­å†…å®¹=é€‰ä¸­å†…å®¹.getSelectedText(0)
end

if å‚æ•°!=nil && string.find(å‚æ•°,"ã€Šã€Šå‘½ä»¤è¡Œã€‹ã€‹")!=nil && string.find(å‚æ•°,"ã€ã€å¤åˆ¶ã€‘ã€‘")!=nil then
	service.getSystemService(Context.CLIPBOARD_SERVICE).setText(é€‰ä¸­å†…å®¹) 
end


if å‚æ•°!=nil && string.find(å‚æ•°,"ã€Šã€Šå‘½ä»¤è¡Œã€‹ã€‹")!=nil && string.find(å‚æ•°,"ã€ã€å‰ªåˆ‡ã€‘ã€‘")!=nil then
	service.getSystemService(Context.CLIPBOARD_SERVICE).setText(é€‰ä¸­å†…å®¹)
	service.commitText("")
end