
local ç‰ˆæœ¬å·="3.5"

local å¸®åŠ©å†…å®¹=[[
</big><font color=red><b>å¸®åŠ©è¯´æ˜</b></font></big>

ä¸­æ–‡è¾“å…¥æ³•è„šæœ¬
è‡ªå®šä¹‰å‰ªåˆ‡æ¿ 3.5
åŸä½œè€…ï¼š æ˜Ÿä¹‚å°˜ 1416165041@qq.com
2020.09.04

--æ— éšœç¢ç‰ˆä¸“ç”¨è„šæœ¬
--è„šæœ¬åç§°: è‡ªå®šä¹‰å‰ªåˆ‡æ¿
--è¯´æ˜ï¼šä¸­æ–‡è¾“å…¥æ³•æ— éšœç¢ç‰ˆåŸç”Ÿå‰ªåˆ‡æ¿ä¼˜åŒ–ç‰ˆ,åŸºäº æ˜Ÿä¹‚å°˜_è‡ªå®šä¹‰å‰ªåˆ‡æ¿3.1 ä¿®æ”¹
--å¢åŠ æœç´¢,ä¼˜å…ˆé¦–é€‰,æ¬¡é€‰ä¸­å†…å®¹
--å¢åŠ é•¿æŒ‰å¿«é€Ÿå‘é€é€‰ä¸­å†…å®¹åˆ°èŠå¤©è½¯ä»¶,éœ€åœ¨èŠå¤©è½¯ä»¶ä¸­å¼€å¯å›è½¦ä¸Šå±
--ç‰ˆæœ¬å·: 3.5
â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚
æ—¥æœŸ: 2020å¹´12æœˆ08æ—¥ğŸ—“ï¸
å†œå†: é¼ ğŸåºšå­å¹´åæœˆå»¿å››
æ—¶é—´: 18:26:19ğŸ••
æ˜ŸæœŸ: å‘¨äºŒ
--åˆ¶ä½œè€…: é£ä¹‹æ¼«èˆ
--é¦–å‘qqç¾¤: Rime åŒæ–‡æ–‹(458845988)
--é‚®ç®±: bj19490007@163.com(ä¸ä¸€å®šåŠæ—¶çœ‹åˆ°)

--ä½¿ç”¨è¯´æ˜
æ— 

--è„šæœ¬é…ç½®è¯´æ˜
<b>ç”¨æ³•ä¸€</b>
â‘ æ”¾åˆ°è„šæœ¬å¯åŠ¨å™¨->è„šæœ¬åº“ç›®å½• ä¸‹ä»»æ„ä½ç½®åŠå­æ–‡ä»¶å¤¹ä¸­,è„šæœ¬å¯åŠ¨å™¨è‡ªåŠ¨æ˜¾ç¤ºè¯¥è„šæœ¬
â‘¡ä¸»é¢˜æ–¹æ¡ˆæŒ‚è½½è„šæœ¬å¯åŠ¨å™¨
â‘¢æ˜¾ç¤ºä¸€ä¸ªé”®ç›˜ç•Œé¢,
å•å‡»ä¸Šå±æ–‡å­—

--------------------
<b>ç”¨æ³•äºŒ</b>
ç¬¬â‘ æ­¥ å°† è„šæœ¬æ–‡ä»¶è§£å‹æ”¾ç½® Android/rime/script æ–‡ä»¶å¤¹å†…

ç¬¬â‘¡æ­¥ å‘ä¸»é¢˜æ–¹æ¡ˆä¸­åŠ å…¥æŒ‰é”®
ä»¥ XXX.trime.yamlä¸»é¢˜æ–¹æ¡ˆä¸ºä¾‹
æ‰¾åˆ°ä»¥ä¸‹èŠ‚ç‚¹preset_keys,åŠ å…¥ä»¥ä¸‹å†…å®¹

preset_keys:
  jianqie_qie: {label: å‰ªåˆ‡æ¿, send: function, command: 'å‰ªåˆ‡æ¿.lua'}
  jianqie_qie1: {label: ğŸ—’, send: function, command: 'å‰ªåˆ‡æ¿.lua'}
  jianqie_qie2: {label: å‰ªåˆ‡æ¿, send: function, command: '01 è„šæœ¬å¯åŠ¨å™¨/è„šæœ¬åº“/å‰ªåˆ‡æ¿.lua'}

  lua_script_cv: {label: å‰ªåˆ‡æ¿, functional: false, send: function, command: "01 è„šæœ¬å¯åŠ¨å™¨/è„šæœ¬åº“/4 è¾“å…¥å·¥å…·/å‰ªåˆ‡æ¿(è‡ªå®šä¹‰).lua", option: "default"}
  lua_script_cv1: {label: å‰ªåˆ‡æ¿, functional: false, send: function, command: "01 è„šæœ¬å¯åŠ¨å™¨/è„šæœ¬åº“/4 è¾“å…¥å·¥å…·/å‰ªåˆ‡æ¿(è‡ªå®šä¹‰).lua", option: "cjbj"}
  lua_script_cv2: {label: å‰ªåˆ‡æ¿, functional: false, send: function, command: "01 è„šæœ¬å¯åŠ¨å™¨/è„šæœ¬åº“/4 è¾“å…¥å·¥å…·/å‰ªåˆ‡æ¿(è‡ªå®šä¹‰).lua", option: "number"}
å‘è¯¥ä¸»é¢˜æ–¹æ¡ˆä»»æ„é”®ç›˜æŒ‰é”®ä¸­åŠ å…¥ä¸Šè¿°æŒ‰é”®æ—¢å¯(æ³¨æ„æ–‡ä»¶æ”¾ç½®ç›®å½•)

]]




require "import"
import "android.widget.*"
import "android.view.*"
import "android.graphics.RectF"
import "android.media.MediaPlayer"
import "android.graphics.drawable.StateListDrawable"
import "java.io.File"
import "android.text.Html"
import "android.os.*"
import "com.osfans.trime.*" --è½½å…¥åŒ…
import "android.graphics.Typeface"
import "script.åŒ….é”®ç›˜æ“ä½œ.åŠŸèƒ½é”®"
import "android.content.Context" 


local å‚æ•°=(...)
local è¾“å…¥æ³•ç›®å½•=tostring(service.getLuaExtDir("")).."/"
local è„šæœ¬ç›®å½•=tostring(service.getLuaExtDir("script")).."/"
local è„šæœ¬è·¯å¾„=debug.getinfo(1,"S").source:sub(2)--è·å–Luaè„šæœ¬çš„å®Œæ•´è·¯å¾„
local çº¯è„šæœ¬å=File(è„šæœ¬è·¯å¾„).getName()
local ç›®å½•=string.sub(è„šæœ¬è·¯å¾„,1,#è„šæœ¬è·¯å¾„-#çº¯è„šæœ¬å)
local è„šæœ¬ç›¸å¯¹è·¯å¾„=string.sub(è„šæœ¬è·¯å¾„,#è„šæœ¬ç›®å½•+1)
local è„šæœ¬ç›¸å¯¹ç›®å½•=string.sub(è„šæœ¬ç›¸å¯¹è·¯å¾„,1,-#çº¯è„šæœ¬å-1)

local é”®ç›˜å=""
local é€‰ä¸­å†…å®¹ = service.getCurrentInputConnection().getSelectedText(0)--å–ç¼–è¾‘æ¡†é€‰ä¸­å†…å®¹,éƒ¨åˆ†appå†…æ— æ•ˆ
local ä¸Šæ¬¡ä¸Šå± = Rime.getCommitText() --å·±ä¸Šå±æ–‡å­—
if é€‰ä¸­å†…å®¹ =="" or é€‰ä¸­å†…å®¹ ==nil then
  é€‰ä¸­å†…å®¹ = ä¸Šæ¬¡ä¸Šå±
end

if å‚æ•°=="" or å‚æ•°==é€‰ä¸­å†…å®¹ or å‚æ•°==nil or å‚æ•°:find("æœç´¢")~=nil or å‚æ•°:find("åˆ†è¯")~=nil then
	é”®ç›˜å="K_default" 
else
	é”®ç›˜å="K_"..å‚æ•°
end

local æ–‡ä»¶=tostring(service.getLuaDir("")).."/clipboard.json"
local çŸ­è¯­æ¿="../script/çŸ­è¯­æ¿.lua"
local çŸ­è¯­æ¿è®°å½•æ–‡æœ¬=tostring(service.getLuaDir("")).."/script/çŸ­è¯­æ¿.txt"

local vibeFont=Typeface.DEFAULT
local å­—ä½“æ–‡ä»¶ = tostring(service.getLuaDir("")).."/fonts/ç‰›ç é£æœºæ‰‹æœº5ä»£è¶…é›†å®‹ä½“.ttf"
if File(å­—ä½“æ–‡ä»¶).exists()==true then
  vibeFont=Typeface.createFromFile(å­—ä½“æ–‡ä»¶)
end--if File(å­—ä½“æ–‡ä»¶)

--æ£€æŸ¥æ–‡ä»¶å­˜åœ¨å¦
if File(æ–‡ä»¶).exists()==false then
 print(æ–‡ä»¶.." ä¸å­˜åœ¨,è¯·å…ˆå¤åˆ¶å†…å®¹" )
 return
end


dofile_ä¿¡æ¯è¡¨=nil
dofile_ä¿¡æ¯è¡¨={}
local function æ˜¾ç¤ºå¸®åŠ©(å†…å®¹)
   dofile_ä¿¡æ¯è¡¨.ä¸Šçº§è„šæœ¬=è„šæœ¬è·¯å¾„
   dofile_ä¿¡æ¯è¡¨.ä¸Šçº§è„šæœ¬æ‰€åœ¨ç›®å½•=ç›®å½•
   dofile_ä¿¡æ¯è¡¨.ä¸Šçº§è„šæœ¬ç›¸å¯¹è·¯å¾„=è„šæœ¬ç›¸å¯¹è·¯å¾„
   dofile_ä¿¡æ¯è¡¨.çº¯è„šæœ¬å=çº¯è„šæœ¬å:sub(1,-5)
   dofile_ä¿¡æ¯è¡¨.å†…å®¹=å†…å®¹
   
   
   dofile(ç›®å½•.."å¸®åŠ©æ¨¡å—.text")--å¯¼å…¥æ¨¡å—

end



function å†™å…¥å†…å®¹åˆ°æ–‡ä»¶æŒ‡å®šè¡Œ(è·¯å¾„,è¡Œæ•°,å†…å®¹)
  local a={}
  for v,s in io.lines(è·¯å¾„) do
	table.insert(a,v.."\n")
  end
  a[è¡Œæ•°]=å†…å®¹.."\n"
  io.open(tostring(è·¯å¾„),"w"):write(table.concat(a)):close()
end


local Clip,å†…å®¹ç»„={},service.getClipBoard()
for i=0,#å†…å®¹ç»„-1 do
  Clip[i+1]=å†…å®¹ç»„[i]
end

  --æœç´¢å‰ªåˆ‡æ¿
local é¢„æœç´¢å†…å®¹=""
  local é€‰ä¸­å†…å®¹=service.getCurrentInputConnection()
  if é€‰ä¸­å†…å®¹!=nil then
    é¢„æœç´¢å†…å®¹=é€‰ä¸­å†…å®¹.getSelectedText(0)
  end
  if Rime.RimeGetInput()~="" then
    é¢„æœç´¢å†…å®¹=Rime.getComposingText()  --å½“å‰å€™é€‰
  end





local function Back() --ç”ŸæˆåŠŸèƒ½é”®èƒŒæ™¯
  local bka=LuaDrawable(function(c,p,d)
	local b=d.bounds
	b=RectF(b.left,b.top,b.right,b.bottom)
	p.setColor(0x49ffffff)
	c.drawRoundRect(b,15,15,p) --åœ†è§’15
  end)
  local bkb=LuaDrawable(function(c,p,d)
	local b=d.bounds
	b=RectF(b.left,b.top,b.right,b.bottom)
	p.setColor(0x49d3d7da)
	c.drawRoundRect(b,15,15,p)
  end)

local stb,state=StateListDrawable(),android.R.attr.state_pressed
  stb.addState({-state},bkb)
  stb.addState({state},bka)
  return stb
end

local function Icon(k,s) --è·å–kåŠŸèƒ½å›¾æ ‡ï¼Œæ²¡æœ‰åˆ™è¿”å›s
  k=Key.presetKeys[k]
  return k and k.label or s
end

local function Bu_R(id) --ç”ŸæˆåŠŸèƒ½é”®
  local ta={TextView,
	gravity=17,
	Background=Back(),
	layout_height=-1,
	layout_width=-1,
	layout_weight=1,
	layout_margin="1dp",
	layout_marginTop="2dp",
	layout_marginBottom="2dp",
	textColor=0xff232323,
	textSize="18dp"}

  if id==1 then
	ta.text=Icon("BackSpace","âŒ«")
	ta.textSize="18dp"
	ta.onClick=function()
	  service.sendEvent("BackSpace")
	end
	ta.OnLongClickListener={onLongClick=function() return true end}
   elseif id==2 then
	ta.text="ç©ºæ ¼"
	ta.textSize="18dp"
	ta.onClick=function()
	  service.sendEvent("space")
	end
	ta.OnLongClickListener={onLongClick=function() 
		service.sendEvent("Tabuhpk")
		return true
	end}
   elseif id==3 then
	ta.text=Icon("Return","â")
	ta.textSize="18dp"
	ta.onClick=function()
	  service.sendEvent("Return")
	end
	ta.OnLongClickListener={onLongClick=function() return true end}
   elseif id==4 then
	ta.text=Icon("è¿”å›","è¿”å›")
	ta.onClick=function()
	service.sendEvent("Keyboard_default")
	ta.text=Icon("Keyboard_default","è¿”å›")
	end
	ta.OnLongClickListener={onLongClick=function()
		service.sendEvent("undo")
		return true
	end}
	elseif id==5 then
	ta.text=Icon("æ¸…é™¤","æ¸…é™¤")
	ta.onClick=function()
	  io.open(æ–‡ä»¶,"w"):write("[\n]"):close()
	  task(300,function()  end)
	  local è¾“å…¥æ³•å®ä¾‹=Trime.getService()
	  è¾“å…¥æ³•å®ä¾‹.loadClipboard()
	  print("æ•°æ®å·²æ¸…é™¤")
	  service.sendEvent("Keyboard_default")
	end
	ta.OnLongClickListener={onLongClick=function() return true end}
	elseif id==6 then
	ta.text="å¸®åŠ©"
	ta.onClick=function()
	  æ˜¾ç¤ºå¸®åŠ©(å¸®åŠ©å†…å®¹)
	end
	ta.OnLongClickListener={onLongClick=function() return true end}
	elseif id==7 then
	ta.text=Icon("å…¨é€‰","å…¨é€‰")
	ta.textSize="18dp"
	ta.onClick=function()
		åŠŸèƒ½_å…¨é€‰()
	end
	elseif id==8 then
	ta.text=Icon("å¤åˆ¶","å¤åˆ¶")
	ta.textSize="18dp"
	ta.onClick=function()
		åŠŸèƒ½_å¤åˆ¶()
--ä¸‹é¢ä¸€æ¡ä¸ºæ‰“å¼€å‰ªåˆ‡æ¿,ä½œç”¨ä¸º:åˆ·æ–°å‰ªåˆ‡æ¿å†…å®¹(åŒå‡»å¤åˆ¶åˆ·æ–°)
		åŠŸèƒ½_è„šæœ¬(è„šæœ¬ç›¸å¯¹ç›®å½•.."å‰ªåˆ‡æ¿.lua","å‰ªåˆ‡æ¿")
	end
	elseif id==9 then
	ta.text=Icon("å‰ªåˆ‡","å‰ªåˆ‡")
	ta.textSize="18dp"
	ta.onClick=function()
		åŠŸèƒ½_å‰ªåˆ‡()
--ä¸‹é¢ä¸€æ¡ä¸ºæ‰“å¼€å‰ªåˆ‡æ¿,ä½œç”¨ä¸º:åˆ·æ–°å‰ªåˆ‡æ¿å†…å®¹(åŒå‡»å‰ªåˆ‡åˆ·æ–°)
		åŠŸèƒ½_è„šæœ¬(è„šæœ¬ç›¸å¯¹ç›®å½•.."å‰ªåˆ‡æ¿.lua","å‰ªåˆ‡æ¿")
	end
	elseif id==10 then
	ta.text=Icon("æœç´¢","æœç´¢")
	ta.textSize="18dp"
	ta.onClick=function()
	  if é¢„æœç´¢å†…å®¹ then
        Key.presetKeys.lua_script_l={label= "è„šæœ¬", send="function", command=è„šæœ¬ç›¸å¯¹è·¯å¾„, option="ã€ã€æœç´¢ã€‘ã€‘"..é¢„æœç´¢å†…å®¹}
      else
        Key.presetKeys.lua_script_l={label= "è„šæœ¬", send="function", command=è„šæœ¬ç›¸å¯¹è·¯å¾„, option=""}
      end
      service.sendEvent("lua_script_l")
	end
	elseif id==11 then
	ta.text=Icon("çŸ­è¯­","çŸ­è¯­æ¿")
	ta.textSize="18dp"
	ta.onClick=function()
      åŠŸèƒ½_è„šæœ¬(çŸ­è¯­æ¿,"çŸ­è¯­æ¿")
	end
	end
  return ta
end

local é»˜è®¤é«˜åº¦=service.getLastKeyboardHeight()
if é»˜è®¤é«˜åº¦<300 then é»˜è®¤é«˜åº¦=300 end

local ids,layout={},{LinearLayout,
  orientation=1,
  --é”®ç›˜é«˜åº¦
  layout_height=é»˜è®¤é«˜åº¦,
  layout_width=-1,
  --èƒŒæ™¯é¢œè‰²
  --BackgroundColor=0xffd7dddd,
  {TextView,
	id="title",
	layout_height="30dp",
	layout_width=-1,
	text="â€¢å¸®åŠ©è¯´æ˜",
	gravity="center",
	paddingLeft="2dp",
	paddingRight="2dp",
	BackgroundColor=0x49d3d7da
	},
	{LinearLayout,
	gravity="right",
	layout_height=-1,
	{LinearLayout,
	  id="main",
	  orientation=1,
	  --å³ä¾§åŠŸèƒ½é”®å®½åº¦
	  layout_weight=1,
	  layout_height=-1,
	  layout_gravity=8|3,
	  {GridView, --åˆ—è¡¨æ§ä»¶
		id="list",
		numColumns=1, --6åˆ—
		paddingLeft="2dp",
		paddingRight="2dp",
		layout_width=-1,
		layout_weight=1}},

   {LinearLayout,
	  orientation=1,
	  layout_weight=1,
	  layout_width="150dp",
	  layout_height=-1,
	  --layout_gravity=5|84,
	Bu_R(7),
	Bu_R(8),
	Bu_R(9),
	Bu_R(2),
	Bu_R(3),
	  },

	{LinearLayout,
	  orientation=1,
	  layout_weight=1,
	  layout_width="150dp",
	  layout_height=-1,
	  --layout_gravity=5|84,
	Bu_R(4),
	Bu_R(11),
	Bu_R(5),
	Bu_R(10),
	Bu_R(1),
	  },
}}


layout=loadlayout(layout,ids)

local data,item={},{LinearLayout,
  layout_width=-1,
  padding="4dp",
  gravity=3|17,
  {TextView,
	id="a",
	textColor=0xffff7744,--å‰ªåˆ‡æ¿åºå·é¢œè‰²
	textSize="10dp"},
  {TextView,
	id="b",
	gravity=3|17,
	paddingLeft="4dp",
	--æœ€å¤§æ˜¾ç¤ºè¡Œæ•°
	MaxLines=3,
	--æœ€å°é«˜åº¦
	MinHeight="30dp",
	Typeface=vibeFont,
	textColor=0xfffcaf17,
	textSize="15dp"}}--å‰ªè´´å†…å®¹é¢œè‰²

local adp=LuaAdapter(service,data,item)
ids.list.Adapter=adp






if utf8.sub(å‚æ•°,1,6)=="ã€ã€æœç´¢ã€‘ã€‘" then
  local æœç´¢å†…å®¹=utf8.sub(å‚æ•°,7)
  print("åŒ¹é… "..æœç´¢å†…å®¹.." ä¸­...")
    local æœç´¢å†…å®¹ç»„,n={},1
    for i=1,#Clip do
      local m=utf8.find(Clip[i],æœç´¢å†…å®¹)
      if m~=nil then
        æœç´¢å†…å®¹ç»„[n]=Clip[i]
        n=n+1
      end
    end
    Clip=æœç´¢å†…å®¹ç»„
		
		local function fresh()
		  table.clear(data)
		  
		  for i=1,#Clip do
			local v=Clip[i]
			local a,b,c=v:match("^%s*([^\n]+)(\n*[^\n]*)(\n*[^\n]*)")
			a=table.concat{utf8.sub(a,1,99),utf8.sub(b,1,99),utf8.sub(c,1,99)}
			local å†…å®¹=v
			--å†…å®¹=å†…å®¹:gsub("\n","<br>")
			å†…å®¹=å†…å®¹:gsub(".",{
			   ["<"]="&lt;",
			   [">"]="&gt;",
			  })
			å†…å®¹=string.gsub(å†…å®¹,"\n","<br>")
			å†…å®¹="</big><font color=red><b>"..tostring(i)..".</b></font></big>"..å†…å®¹
			
			table.insert(data,{b=Html.fromHtml(å†…å®¹)})
			
		  end
		  adp.notifyDataSetChanged()
		end
		fresh()
		
		ids.list.onItemClick=function(l,v,p)
		  local s=Clip[p+1]
		  service.commitText(s)
		end
		
ids.list.onItemLongClick=function(l,v,p)
   dofile_ä¿¡æ¯è¡¨=nil
   dofile_ä¿¡æ¯è¡¨={}
   dofile_ä¿¡æ¯è¡¨.ä¸Šçº§è„šæœ¬=è„šæœ¬è·¯å¾„
   dofile_ä¿¡æ¯è¡¨.ä¸Šçº§è„šæœ¬æ‰€åœ¨ç›®å½•=ç›®å½•
   dofile_ä¿¡æ¯è¡¨.ä¸Šçº§è„šæœ¬ç›¸å¯¹è·¯å¾„=è„šæœ¬ç›¸å¯¹è·¯å¾„
   dofile_ä¿¡æ¯è¡¨.çº¯è„šæœ¬å=çº¯è„šæœ¬å:sub(1,-5)
   dofile_ä¿¡æ¯è¡¨.å†…å®¹=Clip[p+1]
   
   dofile(ç›®å½•.."åˆ†è¯å·¥å…·.text")--å¯¼å…¥æ¨¡å—
  
  return true
end
		
else--if æœç´¢å†…å®¹~
		local Clip=service.getClipBoard()
		local function fresh()
		  table.clear(data)
		  for i=0,#Clip-1 do
			local v=Clip[i]
			local a,b,c=v:match("^%s*([^\n]+)(\n*[^\n]*)(\n*[^\n]*)")
		   a=table.concat{utf8.sub(a or "",1,99),utf8.sub(b or "",1,99),utf8.sub(c or "",1,99)}
			local å†…å®¹=v
			--å†…å®¹=å†…å®¹:gsub("\n","<br>")
			å†…å®¹=å†…å®¹:gsub(".",{
			   ["<"]="&lt;",
			   [">"]="&gt;",
			  })
			å†…å®¹=string.gsub(å†…å®¹,"\n","<br>")
			å†…å®¹="</big><font color=red><b>"..tostring(i+1)..".</b></font></big>"..å†…å®¹
			table.insert(data,{b=Html.fromHtml(å†…å®¹)})
		  end
		  adp.notifyDataSetChanged()
		end
		fresh()
		
		ids.list.onItemClick=function(l,v,p)
		  local s=Clip[p]
		  service.commitText(s)
		  --ç½®é¡¶å·²ä¸Šå±å†…å®¹
		  if p>0 then
			Clip.remove(p)
			Clip.add(0,s)
			fresh()
		  end
		end
		
		ids.list.onItemLongClick=function(l,v,p)
		  local str=Clip[p]
		  local lay={TextView,
			padding="16dp",
			MaxLines=20,
			textIsSelectable=true,
			text=utf8.sub(str,1,3000)..(utf8.len(str)>3000 and "\n..." or ""),
			textColor=0xff232323,
			textSize="15dp"}
		  LuaDialog(service)
		  .setTitle(string.format("%s.  é¢„è§ˆ/æ“ä½œï¼ˆ%sï¼‰",p+1,utf8.len(str)))
		  .setView(loadlayout(lay))
		    .setButton("ç½®é¡¶",function()
			if p>0 then
			  Clip.remove(p)
			  Clip.add(0,str)
			  service.getSystemService(Context.CLIPBOARD_SERVICE).setText(str) 
			end
		  end)
		  
		  .setButton2("åˆ é™¤",function()
			Clip.remove(p)
		  end)
		  .setButton3("æ·»åŠ åˆ°çŸ­è¯­",function()
		  local å†…å®¹=str:gsub("\n","\\n")
--ä¸‹é¢ä¸€è¡Œå†…å®¹ä¸ºåŸå§‹å†…å®¹,å¥½åƒæ²¡å†™å®Œå…¨,æ²¡ç”Ÿæ•ˆ,å› æ­¤æ³¨é‡Šæ‰äº†.
--		  å†™å…¥å†…å®¹åˆ°æ–‡ä»¶æŒ‡å®šè¡Œ(è¾“å…¥æ³•ç›®å½•.."phrase.json",1,"[\n    \""..å†…å®¹.."\"")
		  io.open(çŸ­è¯­æ¿è®°å½•æ–‡æœ¬,"a+"):write("\n"):close()
		  io.open(çŸ­è¯­æ¿è®°å½•æ–‡æœ¬,"a+"):write(å†…å®¹):close()
		  print("çŸ­è¯­æ·»åŠ æˆåŠŸ",å†…å®¹)
		  end)
		  .setOnDismissListener{onDismiss=function()
			  fresh()
		  end}
		  .show()
		  --è¿”å›ï¼ˆçœŸï¼‰ï¼Œå¦åˆ™é•¿æŒ‰ä¹Ÿä¼šè§¦å‘ç‚¹å‡»äº‹ä»¶
		  return true
		end
end--if æœç´¢å†…å®¹

local æ ‡é¢˜=çº¯è„šæœ¬å:sub(1,-5)
  æ ‡é¢˜=æ ‡é¢˜..ç‰ˆæœ¬å·
  if æœç´¢å†…å®¹~="" and æœç´¢å†…å®¹~=nil then
    æ ‡é¢˜=æ ‡é¢˜.."(\""..æœç´¢å†…å®¹.."\" ç›¸å…³å…±"..#Clip.."æ¡)"
  else
    æ ‡é¢˜=æ ‡é¢˜.."(å…¨éƒ¨"..#Clip.."æ¡)"
  end
  
  
ids.title.setText(æ ‡é¢˜)


service.setKeyboard(layout)

--è§†é¢‘è·¯å¾„
local path=ç›®å½•.."mv.mp4"

--è§†é¢‘æ–‡ä»¶ä¸å­˜åœ¨åˆ™ç»ˆæ­¢è„šæœ¬
if os.type(path)~="file"
  return
end
pcall(function()
  local play=MediaPlayer()
  play.setDataSource(path)
  --å¾ªç¯æ’­æ”¾
  play.setLooping(true)
  play.prepare()
  --éŸ³é‡è®¾ç½®ä¸º0
  play.setVolume(0,0)

  local video=loadlayout{SurfaceView,
	--æ·»åŠ èƒŒæ™¯è‰²ï¼Œé¿å…çœ‹ä¸æ¸…æŒ‰é”®
	BackgroundColor=0xffffffff,
	layout_width=-1,
	layout_height=-1}
  layout.addView(video,0) --æŠŠè§†é¢‘å¸ƒå±€æ”¾åˆ°layoutçš„ç¬¬ä¸€ä¸ªï¼Œä¹Ÿå°±æ˜¯æ˜¾ç¤ºåœ¨æœ€åº•å±‚
  video.getHolder().addCallback({
	surfaceCreated=function(holder)
	  play.start()
	  play.setDisplay(holder)
	end,
	surfaceDestroyed=function()
	  --ç•Œé¢å…³é—­ï¼Œé‡Šæ”¾æ’­æ”¾å™¨
	  play.release()
  end})
end)
